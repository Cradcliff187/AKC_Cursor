{% extends "base.html" %}
{% from "components/forms.html" import form_group, select_group %}
{% from "components/cards.html" import info_card, form_card %}
{% from "components/buttons.html" import action_button %}

{% block title %}Profile - AKC CRM{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <!-- Profile Information -->
        <div class="col-lg-4">
            {{ info_card(
                title="Profile Information",
                items=[
                    {"label": "Name", "value": user.first_name + " " + user.last_name},
                    {"label": "Email", "value": user.email},
                    {"label": "Role", "value": user.role|title},
                    {"label": "Member Since", "value": user.created_at|date},
                    {"label": "Last Login", "value": user.last_login|date}
                ]
            ) }}

            {{ info_card(
                title="Activity Summary",
                items=[
                    {"label": "Projects", "value": user.stats.total_projects},
                    {"label": "Tasks", "value": user.stats.total_tasks},
                    {"label": "Time Logged", "value": f"{user.stats.total_hours} hrs"},
                    {"label": "Documents", "value": user.stats.total_documents}
                ]
            ) }}
        </div>

        <!-- Profile Update Form -->
        <div class="col-lg-8">
            {% set form_content %}
                <div class="row">
                    <div class="col-md-6">
                        {{ form_group("First Name", "first_name", value=user.first_name, required=true) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_group("Last Name", "last_name", value=user.last_name, required=true) }}
                    </div>
                </div>

                {{ form_group("Email", "email", type="email", value=user.email, required=true) }}
                
                {{ form_group("Phone", "phone", type="tel", value=user.phone) }}

                {{ select_group("Time Zone", "timezone",
                    options=[
                        {"value": "America/New_York", "label": "Eastern Time (ET)"},
                        {"value": "America/Chicago", "label": "Central Time (CT)"},
                        {"value": "America/Denver", "label": "Mountain Time (MT)"},
                        {"value": "America/Los_Angeles", "label": "Pacific Time (PT)"},
                        {"value": "America/Anchorage", "label": "Alaska Time (AKT)"},
                        {"value": "Pacific/Honolulu", "label": "Hawaii Time (HT)"}
                    ],
                    selected=user.timezone,
                    help_text="Your local time zone for accurate scheduling"
                ) }}

                {{ form_group("Profile Picture", "avatar", type="file", accept="image/*") }}
            {% endset %}

            {{ form_card(
                title="Update Profile",
                form_content=form_content,
                submit_text="Save Changes"
            ) }}

            <!-- Change Password Form -->
            {% set password_form_content %}
                {{ form_group("Current Password", "current_password", type="password", required=true) }}
                {{ form_group("New Password", "new_password", type="password", required=true) }}
                {{ form_group("Confirm New Password", "confirm_password", type="password", required=true) }}
            {% endset %}

            {{ form_card(
                title="Change Password",
                form_content=password_form_content,
                submit_text="Update Password"
            ) }}

            <!-- Notification Preferences -->
            {% set notification_form_content %}
                <div class="mb-3">
                    <div class="form-check mb-2">
                        <input type="checkbox" class="form-check-input" id="email_notifications" name="email_notifications" {% if user.preferences.email_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="email_notifications">Email Notifications</label>
                    </div>
                    <div class="form-check mb-2">
                        <input type="checkbox" class="form-check-input" id="task_reminders" name="task_reminders" {% if user.preferences.task_reminders %}checked{% endif %}>
                        <label class="form-check-label" for="task_reminders">Task Reminders</label>
                    </div>
                    <div class="form-check mb-2">
                        <input type="checkbox" class="form-check-input" id="project_updates" name="project_updates" {% if user.preferences.project_updates %}checked{% endif %}>
                        <label class="form-check-label" for="project_updates">Project Updates</label>
                    </div>
                </div>
            {% endset %}

            {{ form_card(
                title="Notification Preferences",
                form_content=notification_form_content,
                submit_text="Save Preferences"
            ) }}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .avatar-circle {
        width: 100px;
        height: 100px;
        background-color: var(--bs-primary);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .avatar-initials {
        color: white;
        font-size: 2.5rem;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const newPassword = document.getElementById('new_password');
        const confirmPassword = document.getElementById('confirm_password');
        const passwordForm = document.querySelector('form[action="/profile/change-password"]');
        
        passwordForm.addEventListener('submit', function(event) {
            if (newPassword.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity('Passwords do not match');
                event.preventDefault();
            } else {
                confirmPassword.setCustomValidity('');
            }
        });
        
        confirmPassword.addEventListener('input', function() {
            if (newPassword.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity('Passwords do not match');
            } else {
                confirmPassword.setCustomValidity('');
            }
        });
    });
</script>
{% endblock %} 