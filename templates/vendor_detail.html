{% extends "base.html" %}
{% from "components/buttons.html" import action_button, button_group, dropdown_button %}
{% from "components/cards.html" import info_card, stats_card, list_card, activity_card %}
{% from "components/action_bar.html" import detail_action_bar %}
{% from "components/modals.html" import confirm_delete_modal, status_change_modal %}

{% block title %}{{ vendor.name }} - Vendor Details{% endblock %}

{% block content %}
{{ detail_action_bar(
    title=vendor.name,
    subtitle="Vendor Details",
    status=vendor.status,
    status_class=vendor_status_classes[vendor.status],
    primary_actions=[
        action_button("Edit", href=url_for('edit_vendor', vendor_id=vendor.id), icon="edit", type="primary"),
        dropdown_button(
            text="Change Status",
            icon="exchange-alt",
            type="outline-primary",
            items=[
                {"text": status.title(), "icon": status_icons[status], "form_action": url_for('update_vendor_status', vendor_id=vendor.id), "form_data": {"status": status}}
                for status in allowed_status_transitions
            ]
        ),
        action_button("Delete", type="outline-danger", icon="trash", modal_target="deleteVendorModal")
    ]
) }}

<div class="row g-4">
    <!-- Main Content -->
    <div class="col-lg-8">
        <!-- Vendor Information -->
        {{ info_card(
            title="Vendor Information",
            items=[
                {"label": "Company Name", "value": vendor.company_name},
                {"label": "Contact Person", "value": vendor.contact_name},
                {"label": "Email", "value": vendor.email},
                {"label": "Phone", "value": vendor.phone},
                {"label": "Address", "value": vendor.address},
                {"label": "Tax ID", "value": vendor.tax_id},
                {"label": "Registration Date", "value": vendor.registration_date|date}
            ]
        ) }}

        <!-- Services and Materials -->
        {{ list_card(
            title="Services & Materials",
            items=[
                {"title": service.name, "subtitle": service.description}
                for service in vendor.services
            ],
            actions=[
                action_button("Add Service", icon="plus", type="outline-primary", modal_target="addServiceModal")
            ],
            empty_state='<p class="text-muted">No services or materials listed</p>'
        ) }}

        <!-- Recent Activity -->
        {{ activity_card(
            title="Recent Activity",
            activities=vendor.activities
        ) }}
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Performance Stats -->
        {{ stats_card(
            title="Performance Metrics",
            stats=[
                {"label": "Total Orders", "value": vendor.stats.total_orders, "icon": "shopping-cart"},
                {"label": "On-Time Rate", "value": vendor.stats.on_time_rate + "%", "icon": "clock"},
                {"label": "Quality Rating", "value": vendor.stats.quality_rating + "/5", "icon": "star"},
                {"label": "Response Time", "value": vendor.stats.avg_response_time + " hrs", "icon": "reply"}
            ]
        ) }}

        <!-- Active Contracts -->
        {{ list_card(
            title="Active Contracts",
            items=[
                {
                    "title": contract.name,
                    "subtitle": f"Expires: {contract.end_date|date}",
                    "actions": [
                        action_button("View", href=url_for('view_contract', contract_id=contract.id), type="outline-primary", icon="eye")
                    ]
                }
                for contract in vendor.active_contracts
            ],
            actions=[
                action_button("New Contract", icon="file-contract", type="outline-primary", href=url_for('new_contract', vendor_id=vendor.id))
            ],
            empty_state='<p class="text-muted">No active contracts</p>'
        ) }}

        <!-- Recent Documents -->
        {{ list_card(
            title="Recent Documents",
            items=[
                {
                    "title": doc.name,
                    "subtitle": doc.uploaded_at|date,
                    "actions": [
                        action_button("View", href=url_for('view_document', document_id=doc.id), type="outline-primary", icon="eye")
                    ]
                }
                for doc in vendor.recent_documents
            ],
            actions=[
                action_button("Upload", icon="upload", type="outline-primary", modal_target="uploadDocumentModal")
            ],
            empty_state='<p class="text-muted">No documents uploaded</p>'
        ) }}
    </div>
</div>

<!-- Modals -->
{{ confirm_delete_modal(
    id="deleteVendorModal",
    item_name=vendor.name,
    form_action=url_for('delete_vendor', vendor_id=vendor.id)
) }}

{% for status, message in status_messages.items() %}
{{ status_change_modal(
    id="status" + status + "Modal",
    title="Change Status to " + status.title(),
    message=message,
    form_action=url_for('update_vendor_status', vendor_id=vendor.id),
    new_status=status,
    button_style=status_styles[status],
    button_text="Change to " + status.title()
) }}
{% endfor %}
{% endblock %} 